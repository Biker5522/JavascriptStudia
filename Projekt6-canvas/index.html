<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Nic się nie działo, naprawdę nic się...</title>
  </head>
  <body>
    <canvas id="canvas" width="400" height="400"></canvas>
    <br />
    <label for="numBalls">Liczba kul:</label>
    <input type="number" id="numBalls" value="10" />
    <br />
    <label for="ballDistance">Odległość między kulami:</label>
    <input type="number" id="ballDistance" value="100" />
    <br />
    <button id="startButton">Start</button>
    <button id="resetButton">Reset</button>
    <script src="script.js"></script>
  </body>
  <script type="text/javascript">
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    // get user input for number of balls and minimum distance
    const numBallsInput = document.getElementById("numBalls");
    const ballDistanceInput = document.getElementById("ballDistance");

    // set up balls array
    let balls = [];

    // set up variables for animation
    let running = false;
    let animationId;

    // set up event listeners for buttons
    const startButton = document.getElementById("startButton");
    const resetButton = document.getElementById("resetButton");
    startButton.addEventListener("click", startAnimation);
    resetButton.addEventListener("click", resetAnimation);

    // set up event listener for user input
    numBallsInput.addEventListener("input", resetAnimation);
    ballDistanceInput.addEventListener("input", resetAnimation);

    // set up function to start animation
    function startAnimation() {
      if (!running) {
        running = true;
        animate();
      }
    }

    // set up function to reset animation
    function resetAnimation() {
      // stop animation if running
      if (running) {
        running = false;
        cancelAnimationFrame(animationId);
      }
      // clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // create new balls array
      balls = [];
      // add balls to array
      const numBalls = parseInt(numBallsInput.value);
      const minDist = parseFloat(ballDistanceInput.value);
      for (let i = 0; i < numBalls; i++) {
        const radius = 10;
        const x = Math.random() * canvas.width;
        const y = Math.random() * canvas.height;
        const dx = Math.random() * 2 - 1;
        const dy = Math.random() * 2 - 1;
        balls.push({ x, y, dx, dy, radius });
      }
    }

    // set up function to animate balls
    function animate() {
      // clear canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // update ball positions
      for (let i = 0; i < balls.length; i++) {
        // update x and y positions
        balls[i].x += balls[i].dx;
        balls[i].y += balls[i].dy;
        // check for collisions with walls
        if (
          balls[i].x < balls[i].radius ||
          balls[i].x > canvas.width - balls[i].radius
        ) {
          balls[i].dx *= -1;
        }
        if (
          balls[i].y < balls[i].radius ||
          balls[i].y > canvas.height - balls[i].radius
        ) {
          balls[i].dy *= -1;
        }
      }

      // check for collisions between balls
      for (let i = 0; i < balls.length; i++) {
        for (let j = i + 1; j < balls.length; j++) {
          // calculate distance between two balls
          const dist = Math.sqrt(
            (balls[i].x - balls[j].x) ** 2 + (balls[i].y - balls[j].y) ** 2
          );
          // check if distance is less than minimum distance
          if (dist < ballDistanceInput.value) {
            // calculate angle between balls
            const angle = Math.atan2(
              balls[i].y - balls[j].y,
              balls[i].x - balls[j].x
            );
            // calculate new velocities
            const v1 = Math.sqrt(balls[i].dx ** 2 + balls[i].dy ** 2);
            const v2 = Math.sqrt(balls[j].dx ** 2 + balls[j].dy ** 2);
            const m1 = balls[i].radius ** 2;
            const m2 = balls[j].radius ** 2;
            const u1 =
              (v1 * Math.cos(angle) * (m1 - m2)) / (m1 + m2) +
              (v2 * Math.cos(angle + Math.PI) * 2 * m2) / (m1 + m2);
            const u2 =
              (v2 * Math.cos(angle) * (m2 - m1)) / (m1 + m2) +
              (v1 * Math.cos(angle + Math.PI) * 2 * m1) / (m1 + m2);
            const v1x =
              u1 * Math.cos(angle) +
              v1 * Math.sin(angle) * Math.cos(angle + Math.PI / 2);
            const v1y =
              u1 * Math.sin(angle) +
              v1 * Math.sin(angle) * Math.sin(angle + Math.PI / 2);
            const v2x =
              u2 * Math.cos(angle) +
              v2 * Math.sin(angle) * Math.cos(angle + Math.PI / 2);
            const v2y =
              u2 * Math.sin(angle) +
              v2 * Math.sin(angle) * Math.sin(angle + Math.PI / 2);
            // update ball velocities
            balls[i].dx = v1x;
            balls[i].dy = v1y;
            balls[j].dx = v2x;
            balls[j].dy = v2y;
          }
        }
      }

      // draw balls on canvas
      for (let i = 0; i < balls.length; i++) {
        ctx.beginPath();
        ctx.arc(balls[i].x, balls[i].y, balls[i].radius, 0, 2 * Math.PI);
        ctx.fillStyle = "blue";
        ctx.fill();
        ctx.closePath();
      }

      // request next frame of animation
      animationId = requestAnimationFrame(animate);
    }
  </script>
</html>
